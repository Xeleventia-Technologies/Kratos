@using Kratos.Api.Features.Services.GetById

@namespace Kratos.Api._Pages
@page "/service/{name}"
@inject IRepository repo

@code {
  [Parameter] public string? Name { get; set; }

  private Projections.ServiceForUi? service = null;

  protected override async Task OnInitializedAsync()
  {
    service = await repo.GetBySeoFriendlyNameAsync(Name!, CancellationToken.None);
  }
}

<!-- Breadcrumbs -->
<div class="main__breadcrumbs breadcrumbs">
  <div class="container">
    <ul class="breadcrumbs__list">
      <li class="breadcrumbs__list-item">
        <a class="breadcrumbs__list-link" href="/" hx-push-url="true" hx-target="#page-content" hx-swap="innerHTML show:top"> Home </a>
      </li>
      <li class="breadcrumbs__list-item">
        <a class="breadcrumbs__list-link" href="/services" hx-push-url="true" hx-target="#page-content" hx-swap="innerHTML show:top"> Services </a>
      </li>
      <li class="breadcrumbs__list-item">
        <p class="breadcrumbs__list-text">
          @(service?.Name ?? "[No name]")
        </p>
      </li>
    </ul>
  </div>
</div>

<!-- Service Normal Details -->
<div class="main__section-top section-top">
  <div class="container">
    <div class="section-top__inner">
      <div class="section-top__content section-top-content">
        <h1 class="section-top-content__title title">
          @service?.Name
        </h1>
        <p class="about-event-box__text">
          @service?.Summary
        </p>
      </div>
      <div class="section-top__img">
        <img class="section-top__img-image" src="/uploads/services/@service?.ImageFileName" alt="img" />
      </div>
    </div>
  </div>
</div>

<!-- Services Details with its subservices -->
<div class="container">
  <div class="event__inner">
    <section class="event__about about-event" style="width: 100%">
      <div class="about-event__box about-event-box">
        <h2 class="about-event-box__title">About the service</h2>
        <p class="about-event-box__text" style="text-align: justify; font-size: 20px; font-weight: normal;">
          @service?.Description
        </p>
      </div>
    </section>
  </div>
</div>

@if (service?.ChildServices?.Count > 0)
{
  <section class="main__events events">
    <div class="container">
      <div class="events__inner">
        @foreach (var childService in service?.ChildServices!)
        {
          <div class="events__card card card--events">
            <div class="card__inner">
              <a class="card__title card--events-title" href="/service/@childService.SeoFriendlyName" hx-target="#page-content" hx-swap="innerHTML">
                @childService.Name
              </a>
              <ul class="card__list card-list">
                <li class="card-list__item">
                  <p class="card-list__text">
                    @childService.Summary
                  </p>
                </li>
              </ul>
              <a class="card-box__poster" href="/service/@childService.SeoFriendlyName" hx-target="#page-content" hx-swap="innerHTML">
                <img class="card-box__poster-img" src="/uploads/services/@childService.ImageFileName" alt="img" />
              </a>
            </div>
          </div>
        }
      </div>
    </div>
  </section>
}
